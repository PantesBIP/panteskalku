<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Powered By - Toko Mas Pantes BIP</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
    --primary-color: #d4af37;
    --secondary-color: #343a40;
    --accent-color: #f8f9fa;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #f5f5f5;
    color: #333;
}

.navbar {
    background-color: var(--secondary-color) !important;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.navbar-brand {
    font-weight: 700;
    color: var(--primary-color) !important;
    font-size: 1.5rem;
}

.nav-link {
    color: white !important;
    transition: all 0.3s;
}

.nav-link:hover {
    color: var(--primary-color) !important;
    transform: translateY(-2px);
}

.container {
    max-width: 1200px;
}

.card {
    border-radius: 10px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    border: none;
    margin-bottom: 2rem;
    transition: transform 0.3s;
}

.card:hover {
    transform: translateY(-5px);
}

.card-header {
    background-color: var(--primary-color);
    color: white;
    font-weight: 600;
    border-radius: 10px 10px 0 0 !important;
}

.btn-primary {
    background-color: var(--primary-color);
    border-color: var(--primary-color);
}

.btn-primary:hover {
    background-color: #c9a227;
    border-color: #c9a227;
}

.btn-success {
    background-color: #28a745;
}

.btn-danger {
    background-color: #dc3545;
}

.btn-warning {
    background-color: #ffc107;
    color: #212529;
}

.btn-info {
    background-color: #17a2b8;
    color: white;
}

.form-control:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 0.25rem rgba(212, 175, 55, 0.25);
}

footer {
    background-color: var(--secondary-color);
    color: white;
    padding: 2rem 0;
    margin-top: 3rem;
}

.form-buttons {
    display: flex;
    gap: 10px;
    margin-top: 15px;
    flex-wrap: wrap;
}

.delete-btn-container {
    display: none;
}

.select2-container--bootstrap-5 .select2-selection {
    height: 45px;
    padding: 8px 12px;
    border-radius: 5px;
}

.select2-container--bootstrap-5 .select2-selection--single .select2-selection__rendered {
    padding-left: 0;
    line-height: 28px;
}

.select2-container--bootstrap-5 .select2-dropdown {
    border-radius: 5px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}

.detailPenjualan {
    background-color: white;
    padding: 1.5rem;
    border-radius: 8px;
    box-shadow: 0 2px 15px rgba(0,0,0,0.05);
    margin-top: 1rem;
    display: none;
}

.detailPenjualan.show {
    display: block;
}

.detailPenjualan h5 {
    color: var(--primary-color);
    font-weight: 600;
    margin-bottom: 1rem;
}

.detailPenjualan ul {
    list-style-type: none;
    padding-left: 0;
}

.detailPenjualan li {
    padding: 0.3rem 0;
    border-bottom: 1px solid #eee;
}

.detailPenjualan li:last-child {
    border-bottom: none;
    font-weight: bold;
    color: var(--primary-color);
}

#totalPenjualan h3 {
    color: var(--primary-color);
    font-weight: 700;
    text-align: center;
    padding: 1rem;
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 2px 15px rgba(0,0,0,0.05);
}

.tambahBarangBtn {
    width: 100%;
    padding: 10px;
    font-weight: 600;
}

.toggle-detail-btn {
    margin-top: 10px;
}

@media (max-width: 768px) {
    .col-form-label {
        text-align: left !important;
        padding-bottom: 0;
    }
    
    .form-buttons {
        justify-content: center;
    }
    
    .btn {
        flex: 1;
        min-width: 120px;
    }
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.penjualan-form {
    animation: fadeIn 0.5s ease-out;
}

.spinner {
    display: none;
    margin: 20px auto;
    border: 4px solid rgba(0, 0, 0, 0.1);
    border-radius: 50%;
    border-top: 4px solid var(--primary-color);
    width: 40px;
    height: 40px;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Modal Price Table Styles */
.modal-harga {
    display: none;
    position: fixed;
    z-index: 1050;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.5);
}

.modal-content-harga {
    background-color: #fefefe;
    margin: 2% auto;
    padding: 25px;
    border: 1px solid #888;
    width: 90%;
    max-width: 1000px;
    border-radius: 10px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    animation: modalFadeIn 0.3s;
}

@keyframes modalFadeIn {
    from { opacity: 0; transform: translateY(-50px); }
    to { opacity: 1; transform: translateY(0); }
}

.close-harga {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    transition: color 0.3s;
}

.close-harga:hover {
    color: var(--primary-color);
}

.table-harga {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    font-size: 0.9rem;
}

.table-harga th, .table-harga td {
    border: 1px solid #ddd;
    padding: 12px;
    text-align: left;
}

.table-harga th {
    background-color: var(--primary-color);
    color: white;
    position: sticky;
    top: 0;
}

.table-harga tr:nth-child(even) {
    background-color: #f9f9f9;
}

.table-harga tr:hover {
    background-color: #f1f1f1;
}

.harga-highlight {
    font-weight: bold;
    color: var(--primary-color);
}

.search-container {
    margin-bottom: 20px;
}

#hargaSearch {
    width: 100%;
    padding: 10px;
    border-radius: 5px;
    border: 1px solid #ddd;
    font-size: 16px;
}

.modal-footer-harga {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 20px;
    padding-top: 15px;
    border-top: 1px solid #eee;
}

.modal-footer-harga .info-text {
    font-size: 0.9rem;
    color: #666;
}

/* Tambahan style untuk responsif mobile */
@media (max-width: 768px) {
    .modal-content-harga {
        width: 95%;
        margin: 5% auto;
        padding: 15px;
    }
    
    .table-harga {
        font-size: 0.8rem;
    }
    
    .table-harga th, 
    .table-harga td {
        padding: 8px;
    }
    
    .table-harga th:nth-child(4),
    .table-harga td:nth-child(4) {
        display: none;
    }
    
    #hargaTableContainer {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }
    
    .modal-footer-harga {
        flex-direction: column;
        gap: 10px;
    }
}

@media (max-width: 576px) {
    .modal-content-harga {
        width: 98%;
        margin: 2% auto;
        padding: 10px;
    }
    
    .table-harga th, 
    .table-harga td {
        padding: 6px;
        font-size: 0.7rem;
    }
    
    .table-harga th:nth-child(3),
    .table-harga td:nth-child(3) {
        display: none;
    }
}

/* Style untuk floating button */
.floating-view-harga {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 99;
    transition: all 0.3s ease;
}

.btn-view-harga {
    background-color: var(--primary-color);
    color: white;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    text-align: center;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    display: flex;
    align-items: center;
    justify-content: center;
    border: none;
    transition: all 0.3s ease;
}

.btn-view-harga:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 15px rgba(0,0,0,0.4);
}

.btn-view-harga i {
    font-size: 24px;
}

.btn-view-harga .text {
    display: none;
}

@media (min-width: 768px) {
    .btn-view-harga {
        width: auto;
        height: auto;
        padding: 12px 20px;
        border-radius: 30px;
    }
    
    .btn-view-harga i {
        margin-right: 8px;
    }
    
    .btn-view-harga .text {
        display: inline;
    }
}
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-gem me-2"></i>Toko Mas Pantes BIP
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="https://pntsharga.netlify.app/trend">
                            <i class="fas fa-globe me-1"></i> Trend emas
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://pntsharga.netlify.app">
                            <i class="fas fa-calculator me-1"></i> HARGA UPDATE
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="card">
                    <div class="card-header text-center">
                        <h3><i class="fas fa-calculator me-2"></i> Kerja Kerja Kerja</h3>
                        <h3>No Rek</h3>
                        <label>|| BCA: 3747-7721-11</label> <label> || Mandiri : 1340-5000-8111-1 ||</label>
                        <p>A/n Markus W</p>
                        <label>Untuk Barang Amero dengan kode tertentu Lebih baik tanya lagi admin</label>
                    </div>
                    <div class="card-body">
                        <div id="formContainer">
                            <form id="formEmas" class="penjualan-form">
                                <div class="row mb-3">
                                    <label for="kode" class="col-sm-3 col-form-label">Kode (type number)</label>
                                    <div class="col-sm-9">
                                        <input type="number" class="form-control kode" required step="0.01" min="0.01">
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <label for="berat" class="col-sm-3 col-form-label">Berat (type number)</label>
                                    <div class="col-sm-9">
                                        <div class="input-group">
                                            <input type="number" class="form-control berat" required step="0.01" min="0.01">
                                            <span class="input-group-text">gram</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <label for="ongkos" class="col-sm-3 col-form-label">Ongkos</label>
                                    <div class="col-sm-9">
                                        <select class="form-select ongkos" required>
                                            <option value="0">Tidak ada ongkos</option>
                                            <option value="15000">15 ribu x graman</option>
                                            <option value="5">5% x harga bulat</option>
                                            <option value="10">10% x harga bulat</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <label for="discount" class="col-sm-3 col-form-label">Discount</label>
                                    <div class="col-sm-9">
                                        <div class="input-group">
                                            <span class="input-group-text">Rp</span>
                                            <input type="number" class="form-control discount" value="0" min="0">
                                        </div>
                                    </div>
                                </div>
                                <div class="form-buttons">
                                    <button type="button" class="btn btn-primary hitungBtn">
                                        <i class="fas fa-calculator me-1"></i> Hitung
                                    </button>
                                    <button type="reset" class="btn btn-danger clearBtn">
                                        <i class="fas fa-eraser me-1"></i> Reset
                                    </button>
                                    <div class="delete-btn-container">
                                        <button type="button" class="btn btn-warning deleteBtn">
                                            <i class="fas fa-trash me-1"></i> Hapus
                                        </button>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-info toggle-detail-btn">
                                    <i class="fas fa-eye me-1"></i> Tampilkan Detail
                                </button>
                            </form>
                        </div>

                        <button type="button" class="btn btn-success mt-3 tambahBarangBtn">
                            <i class="fas fa-plus-circle me-1"></i> Tambah Barang
                        </button>

                        <div id="detailPenjualan" class="mt-4"></div>
                        <div id="totalPenjualan" class="mt-4"></div>
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal untuk menampilkan tabel harga -->
    <div id="hargaModal" class="modal-harga">
        <div class="modal-content-harga">
            <span class="close-harga">&times;</span>
            <h3><i class="fas fa-table me-2"></i> Daftar Harga Emas</h3>
            
            <div class="search-container">
                <input type="text" id="hargaSearch" placeholder="Cari kode atau keterangan...">
            </div>
            
            <div id="loadingHarga" class="spinner"></div>
            <div id="hargaTableContainer"></div>
            
            <div class="modal-footer-harga">
                <div class="info-text">
                    <i class="fas fa-info-circle me-1"></i> Harga terakhir diperbarui: <span id="lastUpdated"></span>
                </div>
                <button type="button" class="btn btn-primary btn-sm" id="refreshHargaBtn">
                    <i class="fas fa-sync-alt me-1"></i> Refresh Harga
                </button>
            </div>
        </div>
    </div>

    <div class="floating-view-harga">
        <button class="btn btn-view-harga" id="viewHargaBtn">
            <i class="fas fa-table"></i>
            <span class="text">View Harga</span>
        </button>
    </div>

    <footer class="text-center">
        <div class="container">
            <div class="mb-3">
                <a href="https://www.instagram.com/tokomaspantes_bandung/" class="text-white me-3"><i class="fab fa-instagram fa-lg"></i></a>
                <a href="https://api.whatsapp.com/send/?phone=%2B6289656737562&text&type=phone_number&app_absent=0" class="text-white"><i class="fab fa-whatsapp fa-lg"></i></a>
            </div>
            <p>&copy; 2024 Toko Mas. All rights reserved.</p>
            <p class="text-muted">Created with <i class="fas fa-heart text-danger"></i> by kc</p>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="script.js"></script>
<script>
        // Variabel global
        let totalPenjualan = 0;
        let cokim = 1000000; // Default value

        // Fungsi untuk memuat harga dari JSON
        async function loadHargaEmas() {
            try {
                const response = await fetch('harga_harian.json');
                if (!response.ok) throw new Error('Gagal memuat data harga');
                const data = await response.json();
                cokim = data.hargaEmas.cokim || 1000000; // Ambil nilai cokim dari JSON atau gunakan default
                
                console.log('Data harga berhasil dimuat');
                
                // Update last updated time
                const now = new Date();
                $('#lastUpdated').text(now.toLocaleString('id-ID'));
                
                // Inisialisasi form pertama
                if ($('#formEmas').length) {
                    initializeFormElements($('#formEmas'));
                }
            } catch (error) {
                console.error('Error:', error);
                // Fallback data jika file JSON tidak ada
                cokim = 1000000;
                
                // Update last updated time with fallback
                const now = new Date();
                $('#lastUpdated').text(now.toLocaleString('id-ID') + ' (data offline)');
                
                alert('Gagal memuat data harga terbaru. Menggunakan harga default.');
            }
        }

        // Initialize form elements
        function initializeFormElements(form) {
            // Toggle detail button
            form.find('.toggle-detail-btn').off('click').on('click', function() {
                const detailContainer = form.next('.detailPenjualan');
                const isVisible = detailContainer.hasClass('show');
                
                if (isVisible) {
                    detailContainer.removeClass('show');
                    $(this).html('<i class="fas fa-eye me-1"></i> Tampilkan Detail');
                } else {
                    detailContainer.addClass('show');
                    $(this).html('<i class="fas fa-eye-slash me-1"></i> Sembunyikan Detail');
                }
            });
            
            // Hitung button
            form.find('.hitungBtn').off('click').on('click', function() {
                hitungHarga(form);
            });
        }

        // Fungsi untuk menghitung harga
        function hitungHarga(form) {
            const kode = parseFloat(form.find('.kode').val());
            const berat = parseFloat(form.find('.berat').val());
            const ongkosType = form.find('.ongkos').val();
            const discount = parseFloat(form.find('.discount').val()) || 0;

            if (isNaN(kode)) {
                alert("Harap isi kode dengan angka yang valid.");
                return;
            }

            if (isNaN(berat)) {
                alert("Harap isi berat dengan angka yang valid.");
                return;
            }

            // Hitung harga dasar (cokim x kode)
            const hargaDasar = cokim * (kode / 100);
            
            // Bulatkan harga dasar
            let hasilBulat = Math.round(hargaDasar / 1000) * 1000;
            if (hargaDasar % 1000 > 500) {
                hasilBulat = Math.ceil(hargaDasar / 1000) * 1000;
            } else if (hargaDasar % 1000 > 0) {
                hasilBulat = Math.floor(hargaDasar / 1000) * 1000 + 500;
            }

            // Hitung total sebelum ongkos
            const totalSebelumOngkos = hasilBulat * berat;

            // Hitung ongkos
            let ongkos = 0;
            if (ongkosType === "15000") {
                ongkos = berat < 1 ? 15000 : 15000 * berat;
            } else if (ongkosType === "5") {
                ongkos = totalSebelumOngkos * 0.05;
            } else if (ongkosType === "10") {
                ongkos = totalSebelumOngkos * 0.10;
            }

            // Bulatkan ongkos
            ongkos = Math.round(ongkos / 1000) * 1000;
            if (ongkos % 1000 > 500) {
                ongkos = Math.ceil(ongkos / 1000) * 1000;
            } else if (ongkos % 1000 > 0) {
                ongkos = Math.floor(ongkos / 1000) * 1000 + 500;
            }

            // Hitung harga sebelum discount
            let hargaSebelumDiscount = totalSebelumOngkos + ongkos;

            // Bulatkan harga sebelum discount
            hargaSebelumDiscount = Math.round(hargaSebelumDiscount / 1000) * 1000;
            if (hargaSebelumDiscount % 1000 > 500) {
                hargaSebelumDiscount = Math.ceil(hargaSebelumDiscount / 1000) * 1000;
            } else if (hargaSebelumDiscount % 1000 > 0) {
                hargaSebelumDiscount = Math.floor(hargaSebelumDiscount / 1000) * 1000 + 500;
            }

            // Hitung harga setelah discount
            let hargaFix = hargaSebelumDiscount - discount;
            
            // Pastikan harga tidak negatif
            if (hargaFix < 0) {
                hargaFix = 0;
            }

            // Update total penjualan
            const previousHargaFix = form.data('hargaFix') || 0;
            totalPenjualan = totalPenjualan - previousHargaFix + hargaFix;
            updateTotalPenjualan(totalPenjualan);

            // Simpan hargaFix ke form
            form.data('hargaFix', hargaFix);

            // Tampilkan detail
            updateDetailPenjualan(form, kode, berat, hasilBulat, totalSebelumOngkos, ongkos, hargaSebelumDiscount, discount, hargaFix);
        }

        function updateTotalPenjualan(newTotal) {
            totalPenjualan = newTotal;
            $('#totalPenjualan').html(<h3>Total Penjualan: Rp. ${totalPenjualan.toLocaleString('id-ID')}</h3>);
        }

        function updateDetailPenjualan(form, kode, berat, hargaPerGram, totalSebelumOngkos, ongkos, hargaSebelumDiscount, discount, hargaFix) {
            const detailHtml = `
                <div class="detailPenjualan show">
                    <h5><i class="fas fa-info-circle me-2"></i>Detail Perhitungan</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>Kode:</strong> ${kode}%</p>
                            <p><strong>Berat:</strong> ${berat} gram</p>
                            <p><strong>COKIM:</strong> Rp. ${cokim.toLocaleString('id-ID')}</p>
                        </div>
                        <div class="col-md-6">
                            <ul>
                                <li>Harga per gram (COKIM × ${kode}%): Rp. ${hargaPerGram.toLocaleString('id-ID')}</li>
                                <li>Total sebelum ongkos (Harga × Berat): Rp. ${totalSebelumOngkos.toLocaleString('id-ID')}</li>
                                ${ongkos > 0 ? <li>Ongkos: Rp. ${ongkos.toLocaleString('id-ID')}</li> : ''}
                                <li>Harga Sebelum Discount: Rp. ${hargaSebelumDiscount.toLocaleString('id-ID')}</li>
                                ${discount > 0 ? <li>Discount: Rp. ${discount.toLocaleString('id-ID')}</li> : ''}
                                <li class="fw-bold">Harga Final: Rp. ${hargaFix.toLocaleString('id-ID')}</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
            
            form.next('.detailPenjualan').remove();
            form.after(detailHtml);
            
            form.find('.toggle-detail-btn').html('<i class="fas fa-eye-slash me-1"></i> Sembunyikan Detail');
        }

        function clearTotalPenjualan() {
            totalPenjualan = 0;
            $('#totalPenjualan').html('');
            $('.detailPenjualan').remove();
        }

        // Fungsi untuk memuat tabel harga
        function loadHargaTable() {
            const container = $('#hargaTableContainer');
            const loading = $('#loadingHarga');
            
            container.empty();
            loading.show();
            
            let tableHtml = `
                <div class="table-responsive">
                    <table class="table-harga" id="hargaTable">
                        <thead>
                            <tr>
                                <th>Keterangan</th>
                                <th>COKIM</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Harga COKIM</td>
                                <td class="harga-highlight">Rp. ${cokim.toLocaleString('id-ID')}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            `;
            
            container.html(tableHtml);
            loading.hide();
            
            // Inisialisasi pencarian
            $('#hargaSearch').on('keyup', function() {
                const value = $(this).val().toLowerCase();
                $("#hargaTable tbody tr").filter(function() {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                });
            });
        }
                
        // Event listener untuk document ready
        $(document).ready(function() {
            // Load harga emas saat pertama kali
            loadHargaEmas();
            
            // Show loading spinner temporarily (demo purposes)
            $('.spinner').show();
            setTimeout(function() {
                $('.spinner').hide();
            }, 1000);
            
            // Modal harga
            const modal = document.getElementById("hargaModal");
            const btn = document.getElementById("viewHargaBtn");
            const span = document.getElementsByClassName("close-harga")[0];
            
            btn.onclick = function() {
                modal.style.display = "block";
                loadHargaTable();
                $('#hargaSearch').focus();
            }
            
            span.onclick = function() {
                modal.style.display = "none";
            }
            
            window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }
            
            // Refresh harga button
            $('#refreshHargaBtn').on('click', function() {
                loadHargaEmas().then(() => {
                    loadHargaTable();
                    alert('Data harga berhasil diperbarui!');
                }).catch(error => {
                    console.error('Error:', error);
                    alert('Gagal memuat data harga terbaru. Menggunakan data yang ada.');
                });
            });
            
            // Tambah barang button
            $('.tambahBarangBtn').on('click', function() {
                const formClone = $('#formEmas').clone();
                formClone.find('input, select').val('');
                formClone.find('.discount').val('0');
                formClone.removeAttr('id');
                formClone.find('.delete-btn-container').css('display', 'block');
                formClone.find('.detailPenjualan').remove();
                $('#formContainer').append(formClone);
                
                // Initialize the new form
                initializeFormElements(formClone);
                
                // Scroll to the new form
                $('html, body').animate({
                    scrollTop: formClone.offset().top - 100
                }, 500);
            });
            
            // Clear button
            $(document).on('click', '.clearBtn', function() {
                const form = $(this).closest('.penjualan-form');
                const previousHargaFix = form.data('hargaFix') || 0;
                totalPenjualan -= previousHargaFix;
                updateTotalPenjualan(totalPenjualan);
                
                form.removeData('hargaFix');
                form.next('.detailPenjualan').remove();
                
                // Reset toggle button
                form.find('.toggle-detail-btn').html('<i class="fas fa-eye me-1"></i> Tampilkan Detail');
            });
            
            // Delete button
            $(document).on('click', '.deleteBtn', function() {
                const form = $(this).closest('.penjualan-form');
                const previousHargaFix = form.data('hargaFix') || 0;
                totalPenjualan -= previousHargaFix;
                updateTotalPenjualan(totalPenjualan);
                
                form.next('.detailPenjualan').remove();
                form.remove();
            });
            
            // Floating button scroll effect
            $(window).scroll(function() {
                if ($(window).scrollTop() > 100) {
                    $('.floating-view-harga').css({
                        'bottom': '20px',
                        'right': '20px',
                        'transition': 'all 0.3s ease'
                    });
                } else {
                    $('.floating-view-harga').css({
                        'bottom': '20px',
                        'right': '20px',
                        'transition': 'all 0.3s ease'
                    });
                }
            });
        });
    </script>

</body>
</html>
